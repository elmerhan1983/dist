<%- include('partials/head') %>
<%- include('partials/header') %>
<main class="section">
  <div class="container">
    <h1>Wiki 管理（Markdown）</h1>
    <%- include('partials/admin-nav') %>
    <% if (status) { %><p class="admin-status">Status: <%= status %></p><% } %>

    <section class="admin-block">
      <h2>新增 Wiki</h2>
      <form action="/api/admin/wiki/create" method="post" class="admin-form">
        <label>标题(EN) <input name="title" required /></label>
        <label>标题(简中) <input name="titleZh" /></label>
        <label>标题(繁中) <input name="titleZhTw" /></label>
        <label>Slug(可选) <input name="slug" placeholder="auto-generated" /></label>
        <label>分类(EN) <input name="category" placeholder="Process Basics" /></label>
        <label>分类(简中) <input name="categoryZh" /></label>
        <label>分类(繁中) <input name="categoryZhTw" /></label>
        <div></div>
        <label class="full">摘要(EN) <textarea name="excerpt" rows="2"></textarea></label>
        <label class="full">摘要(简中) <textarea name="excerptZh" rows="2"></textarea></label>
        <label class="full">摘要(繁中) <textarea name="excerptZhTw" rows="2"></textarea></label>
        <label class="full">内容 EN（支持从 Docmost/Notion 粘贴，保留格式）</label>
        <div class="markdown-editor">
          <div class="markdown-toolbar">
            <button type="button" class="btn editor-toggle">全屏编辑</button>
          </div>
          <textarea class="markdown-textarea rich-source" name="contentMarkdown" rows="12" data-expandable data-rich-editor></textarea>
        </div>
        <label class="full">内容 简中</label>
        <div class="markdown-editor">
          <div class="markdown-toolbar">
            <button type="button" class="btn editor-toggle">全屏编辑</button>
          </div>
          <textarea class="markdown-textarea rich-source" name="contentMarkdownZh" rows="12" data-expandable data-rich-editor></textarea>
        </div>
        <label class="full">内容 繁中</label>
        <div class="markdown-editor">
          <div class="markdown-toolbar">
            <button type="button" class="btn editor-toggle">全屏编辑</button>
          </div>
          <textarea class="markdown-textarea rich-source" name="contentMarkdownZhTw" rows="12" data-expandable data-rich-editor></textarea>
        </div>
        <div class="admin-actions"><button class="btn btn-primary" type="submit">Create</button></div>
      </form>
    </section>

    <section class="admin-block">
      <h2>现有 Wiki</h2>
      <input class="filter-input" type="search" placeholder="搜索标题/Slug/分类..." data-filter-target="wikiList" />
      <div id="wikiList">
      <% wikiArticles.forEach((item) => { %>
      <details class="admin-collapse">
        <summary><strong><%= item.title %></strong> · Slug: <%= item.slug %> · Updated: <%= item.updatedAt %></summary>
        <article class="admin-item admin-collapse-body">
          <form action="/api/admin/wiki/<%= item.id %>/update" method="post" class="admin-form">
            <label>标题(EN) <input name="title" value="<%= item.title %>" required /></label>
            <label>标题(简中) <input name="titleZh" value="<%= item.titleZh || '' %>" /></label>
            <label>标题(繁中) <input name="titleZhTw" value="<%= item.titleZhTw || '' %>" /></label>
            <label>Slug <input name="slug" value="<%= item.slug %>" /></label>
            <label>分类(EN) <input name="category" value="<%= item.category %>" /></label>
            <label>分类(简中) <input name="categoryZh" value="<%= item.categoryZh || '' %>" /></label>
            <label>分类(繁中) <input name="categoryZhTw" value="<%= item.categoryZhTw || '' %>" /></label>
            <div></div>
            <label class="full">摘要(EN) <textarea name="excerpt" rows="2"><%= item.excerpt %></textarea></label>
            <label class="full">摘要(简中) <textarea name="excerptZh" rows="2"><%= item.excerptZh || '' %></textarea></label>
            <label class="full">摘要(繁中) <textarea name="excerptZhTw" rows="2"><%= item.excerptZhTw || '' %></textarea></label>
            <label class="full">内容 EN（支持从 Docmost/Notion 粘贴，保留格式）</label>
            <div class="markdown-editor">
              <div class="markdown-toolbar">
                <button type="button" class="btn editor-toggle">全屏编辑</button>
              </div>
              <textarea class="markdown-textarea rich-source" name="contentMarkdown" rows="12" data-expandable data-rich-editor><%= item.contentMarkdown %></textarea>
            </div>
            <label class="full">内容 简中</label>
            <div class="markdown-editor">
              <div class="markdown-toolbar">
                <button type="button" class="btn editor-toggle">全屏编辑</button>
              </div>
              <textarea class="markdown-textarea rich-source" name="contentMarkdownZh" rows="12" data-expandable data-rich-editor><%= item.contentMarkdownZh || '' %></textarea>
            </div>
            <label class="full">内容 繁中</label>
            <div class="markdown-editor">
              <div class="markdown-toolbar">
                <button type="button" class="btn editor-toggle">全屏编辑</button>
              </div>
              <textarea class="markdown-textarea rich-source" name="contentMarkdownZhTw" rows="12" data-expandable data-rich-editor><%= item.contentMarkdownZhTw || '' %></textarea>
            </div>
            <div class="admin-actions"><button class="btn btn-primary" type="submit">Update</button></div>
          </form>
          <form action="/api/admin/wiki/<%= item.id %>/delete" method="post" onsubmit="return confirm('Delete this wiki item?')">
            <button class="btn" type="submit">Delete</button>
          </form>
        </article>
      </details>
      <% }) %>
      </div>
    </section>
  </div>
</main>
<%- include('partials/footer') %>
